(this.webpackJsonpterrene=this.webpackJsonpterrene||[]).push([[0],{100:function(e,t,n){e.exports=n(133)},132:function(e,t,n){},133:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(23);n(107);var o=n(15),c=n.n(o),s=n(81),l=n.n(s),u=n(73),m=n(158),p=n(157),f=n(8),v=n(75),g=n(12),d=n(0),h=n(82),b=n(27);Object(f.c)({PointerLockControlsImpl:h.a});var O=function(e){var t=e.movementSpeed,n=Object(a.useRef)(),i=Object(f.f)(),o=i.camera,c=i.gl.domElement,s=Object(a.useMemo)((function(){return new d.Clock}),[]),l=Object(a.useState)(!1),u=Object(g.a)(l,2),m=u[0],p=u[1],v=Object(a.useState)(!1),h=Object(g.a)(v,2),O=h[0],y=h[1],j=Object(a.useState)(!1),x=Object(g.a)(j,2),E=x[0],S=x[1],w=Object(a.useState)(!1),M=Object(g.a)(w,2),k=M[0],T=M[1],N=Object(a.useState)(!1),P=Object(g.a)(N,2),_=P[0],z=P[1],D=Object(a.useState)(!1),C=Object(g.a)(D,2),I=C[0],L=C[1];Object(f.d)((function(){if(n.current.isLocked){var e=s.getDelta();if(m||O){var a=(Number(m)-Number(O))*e*t;n.current.moveForward(a)}if(E||k){var r=(Number(k)-Number(E))*e*t;n.current.moveRight(r)}if(_||I){var i=(Number(_)-Number(I))*e*t;o.position.y+=i}}}));var R=function(){n.current.lock()},A=function(e){switch(e.keyCode){case b.f:p(!0);break;case b.c:y(!0);break;case b.a:S(!0);break;case b.b:T(!0);break;case b.e:z(!0);break;case b.d:L(!0)}},F=function(e){switch(e.keyCode){case b.f:p(!1);break;case b.c:y(!1);break;case b.a:S(!1);break;case b.b:T(!1);break;case b.e:z(!1);break;case b.d:L(!1)}};return Object(a.useEffect)((function(){return c.addEventListener("mousedown",R,!1),document.addEventListener("keydown",A,!1),document.addEventListener("keyup",F,!1),function(){c.removeEventListener("mousedown",R,!1),document.removeEventListener("keydown",A,!1),document.removeEventListener("keyup",F,!1)}}),[c]),r.a.createElement("pointerLockControlsImpl",{ref:n,args:[o,c]})};O.defaultProps={movementSpeed:5};var y,j=O,x=n(159),E=n(156),S=n(160),w=n(155),M=n(153),k=n(161),T=n(152),N=Object(T.a)((function(e){return{listItemText:{width:e.spacing(25)}}})),P=Object(a.memo)((function(e){var t=e.sectionName,n=e.optionsEnum,a=e.options,i=e.setOptions,o=N();return r.a.createElement(r.a.Fragment,null,r.a.createElement(M.a,null,t),n.map((function(e){var t=e.displayName,n=e.name,c=e.min,s=e.max,l=e.step;return r.a.createElement(S.a,{dense:!0,key:n},r.a.createElement(w.a,{className:o.listItemText},t),r.a.createElement(k.a,{component:"div",color:"secondary",min:c,max:s,step:l,valueLabelDisplay:"auto",value:a[n],onChange:function(e,t){return i(n,t)}}))})))})),_=Object.freeze({OPTIONS:"TerrainAction_OPTIONS",RESET_OPTIONS:"TerrainAction_RESET_OPTIONS"}),z=Object.freeze({OPTIONS:"FogAction_OPTIONS",RESET_OPTIONS:"FogAction_RESET_OPTIONS"}),D=Object.freeze({OPTIONS:"WaterAction_OPTIONS",RESET_OPTIONS:"WaterAction_RESET_OPTIONS"}),C=function(e){return e.fog.options},I=function(e){return e.terrain.options},L=function(e){return e.water.options},R=[{displayName:"Density",name:"density",min:0,max:.5,step:.001}],A=[{displayName:"Height Major",name:"heightMajor",min:0,max:10,step:.1},{displayName:"Spacing Major",name:"spacingMajor",min:0,max:1,step:.01},{displayName:"Height Minor",name:"heightMinor",min:0,max:1,step:.01},{displayName:"Spacing Minor",name:"spacingMinor",min:0,max:5,step:.05}],F=[{displayName:"Height",name:"height",min:-5,max:5,step:.1},{displayName:"Speed",name:"speed",min:1,max:4,step:.1}],W=Object(T.a)((function(e){return{sideDrawer:{width:"20%",overflowX:"hidden"},list:{display:"flex",flexDirection:"column",height:"100%"},options:{flexGrow:1},resetButton:{color:e.palette.secondary.light}}})),G=Object(a.memo)((function(){var e=W(),t=Object(i.b)(),n=Object(i.c)(I),o=Object(i.c)(C),c=Object(i.c)(L),s=Object(a.useCallback)((function(e,n){return t(function(e,t){return{type:z.OPTIONS,name:e,value:t}}(e,n))}),[t]),l=Object(a.useCallback)((function(e,n){return t(function(e,t){return{type:_.OPTIONS,name:e,value:t}}(e,n))}),[t]),u=Object(a.useCallback)((function(e,n){return t(function(e,t){return{type:D.OPTIONS,name:e,value:t}}(e,n))}),[t]);return r.a.createElement(x.a,{className:e.sideDrawer,variant:"permanent",classes:{paper:e.sideDrawer}},r.a.createElement(E.a,{className:e.list},r.a.createElement(m.a,{className:e.options},r.a.createElement(P,{sectionName:"Fog",optionsEnum:R,options:o,setOptions:s}),r.a.createElement(P,{sectionName:"Terrain",optionsEnum:A,options:n,setOptions:l}),r.a.createElement(P,{sectionName:"Water",optionsEnum:F,options:c,setOptions:u})),r.a.createElement(S.a,{button:!0,dense:!0,onClick:function(){t({type:z.RESET_OPTIONS}),t({type:_.RESET_OPTIONS}),t({type:D.RESET_OPTIONS})}},r.a.createElement(w.a,{primary:"Reset all",classes:{primary:e.resetButton}}))))})),B=n(162),U=n(67),K=Object(T.a)((function(e){return{backdrop:{width:"calc(100% - ".concat("20%",")"),left:"20%",zIndex:e.zIndex.drawer}}})),H=function(){var e=K(),t=Object(a.useState)(!0),n=Object(g.a)(t,2),i=n[0],o=n[1];return r.a.createElement(B.a,{className:e.backdrop,open:i,onClick:function(){return o(!1)}},r.a.createElement("div",null,r.a.createElement(U.a,{variant:"h3",color:"textPrimary",align:"center",paragraph:!0},"Terrene"),r.a.createElement(U.a,{variant:"body1",color:"textPrimary",align:"center"},"Move: WASD"),r.a.createElement(U.a,{variant:"body1",color:"textPrimary",align:"center"},"Ascend/Descend: Space/Shift"),r.a.createElement(U.a,{variant:"body1",color:"textPrimary",align:"center"},"Enable/Disable Controls: Click/Esc")))},X=function(e){return"".concat("/terrene","/assets/aerial_grass_rock/aerial_grass_rock_").concat(e,"_2k.jpg")},Y=Object.freeze({camera:{position:[0,1,2.5],movementSpeed:5},lights:{directional:[{direction:new d.Vector3(.5,1,.5).normalize(),intensity:.75}],hemisphere:{skyColor:"lightblue",groundColor:"brown",intensity:.2}},fog:{color:"lightgrey",density:.05},terrain:{size:20,divisions:150,position:[0,0,0],rotation:[-Math.PI/2,0,0],colorMap:X("diff"),colorMapScale:[10,10],normalMap:X("nor"),displacementMap:X("disp"),roughnessMap:X("rough"),metalness:.5,uniforms:{heightMajor:3,spacingMajor:.25,heightMinor:.3,spacingMinor:1.25}},water:{normalMap:(y="nor","".concat("/terrene","/assets/water/").concat(y,".jpg")),uniforms:{height:-.3,speed:2,kAmbient:.1,kDiffuse:.6,kSpecular:.8,shininess:128,baseColor:"lightblue"}},tileSideLength:3,epsilon:1e-7}),$=n(18),q=n(3),J=n(6),V=n(90),Z=function(){function e(){Object(q.a)(this,e),this.gpu=new V.GPU,this.elevationKernel=this.gpu.createKernel("function (\n      vertices, position, heightMajor, spacingMajor, heightMinor, spacingMinor,\n    ) {\n      const vertex = vertices[this.thread.x];\n      const x = vertex[0] + position[0];\n      const z = vertex[1] + position[1];\n\n      let elevation = 0.0;\n      /* eslint-disable no-undef */\n      elevation += heightMajor * perlinNoise([x * spacingMajor, z * spacingMajor]);\n      elevation += heightMinor * perlinNoise([x * spacingMinor, z * spacingMinor]);\n      /* eslint-enable no-undef */\n      return elevation;\n    }").setDynamicOutput(!0).setArgumentTypes({vertices:"Array1D(2)",position:"Array(2)",heightMajor:"Float",spacingMajor:"Float",heightMinor:"Float",spacingMinor:"Float"}).addNativeFunction("perlinNoise","#define GLSLIFY 1\n//\tClassic Perlin 2D Noise \n//\tby Stefan Gustavson\n//  https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83\n\n// Make sure perlin noise is the first function, so we can use it GPU.js\nfloat perlinNoise(vec2 P);\n\nvec4 permute(vec4 x) {\n  return mod((x * 34.0 + 1.0) * x, 289.0);\n}\n\nvec2 fade(vec2 t) {\n  return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat perlinNoise(vec2 P) {\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n  vec4 i = permute(permute(ix) + iy);\n  vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...\n  vec4 gy = abs(gx) - 0.5;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n  vec4 norm = 1.79284291400159 - 0.85373472095314 * \n    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n")}return Object(J.a)(e,[{key:"generateElevation",value:function(e,t,n,a,r,i,o){return this.elevationKernel.setOutput([t]),this.elevationKernel(e,n,a,r,i,o)}}]),e}(),Q=n(24),ee=n(4),te=n(5),ne=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a,r;Object(q.a)(this,n),r=t.call(this,Object(Q.a)(Object(Q.a)({},e),{},{side:d.DoubleSide}));var i=Y.terrain,o=new d.TextureLoader,c=o.load(i.colorMap);c.wrapS=d.RepeatWrapping,c.wrapT=d.RepeatWrapping,(a=c.repeat).set.apply(a,Object($.a)(i.colorMapScale)),c.updateMatrix();var s=o.load(i.normalMap);s.wrapS=d.RepeatWrapping,s.wrapT=d.RepeatWrapping;var l=o.load(i.displacementMap);l.wrapS=d.RepeatWrapping,l.wrapT=d.RepeatWrapping;var u=o.load(i.roughnessMap);return u.wrapS=d.RepeatWrapping,u.wrapT=d.RepeatWrapping,r.map=c,r.normalMap=s,r.normalMapType=d.TangentSpaceNormalMap,r.displacementMap=l,r.roughnessMap=u,r.metalness=i.metalness,r}return n}(d.MeshStandardMaterial),ae=Object(a.memo)((function(e){var t=e.tileOffsets,n=e.numTiles,o=Object(a.useMemo)((function(){return Object($.a)(new Array(n).keys())}),[n]),c=Object(a.useRef)(o.map((function(){return Object(a.createRef)()}))),s=Object(f.f)().gl,l=Y.terrain,u=Object(a.useMemo)((function(){return new Z}),[]),m=Object(a.useMemo)((function(){return new ne}),[]),p=Object(i.c)(I);return Object(a.useEffect)((function(){var e=s.getContext(),n=e.getParameter(e.MAX_TEXTURE_SIZE);t.forEach((function(e,t){var a=c.current[t].current,r=a.position,i=a.geometry.attributes;r.set.apply(r,Object($.a)(e).concat([0]));for(var o=i.position.array,s=[],l=0;l<o.length;l+=3)s.push([o[l],o[l+1]]);for(var m=Math.min(n,s.length),f=0;f<s.length;f+=m)for(var v=s.slice(f,f+m),g=u.generateElevation(v,v.length,e,p.heightMajor,p.spacingMajor,p.heightMinor,p.spacingMinor),d=0;d<v.length;d+=1)o[3*(d+f)+2]=g[d];i.position.needsUpdate=!0}))}),[s,u,p,t]),r.a.createElement("group",{rotation:l.rotation},o.map((function(e,t){return r.a.createElement("mesh",{ref:c.current[t],key:String(e),material:m},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[l.size,l.size,l.divisions,l.divisions]}))})))})),re=function(e){Object(ee.a)(n,e);var t=Object(te.a)(n);function n(e){var a;Object(q.a)(this,n),a=t.call(this,Object(Q.a)(Object(Q.a)({},e),{},{side:d.DoubleSide,vertexShader:"#version 300 es\n#define GLSLIFY 1\n\nout vec3 worldPos;\nout vec2 texCoords;\n\n#include <fog_pars_vertex>\n\nvoid main() {\n  vec4 worldPos4 = modelMatrix * vec4(position, 1.0);\n  vec4 mvPosition = viewMatrix * worldPos4;\n  worldPos = worldPos4.xyz;\n  texCoords = uv;\n\n  gl_Position = projectionMatrix * mvPosition;\n\n  #include <fog_vertex>\n}",fragmentShader:"#version 300 es\n#define GLSLIFY 1\n\n// Adapted from https://29a.ch/slides/2012/webglwater/\n\nin vec3 worldPos;\nin vec2 texCoords;\n\nout vec4 out_FragColor;\n#define gl_FragColor out_FragColor\n\nuniform sampler2D normalMap;\nuniform float time;\n\nuniform float kAmbient;\nuniform float kDiffuse;\nuniform float kSpecular;\nuniform float shininess;\nuniform vec3 baseColor;\n\n#include <common>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n\nvec4 getNoise(vec2 uv) {\n  vec2 uvs[4];\n  uvs[0] = uv / 103.0 + vec2(time / 17.0, time / 29.0);\n  uvs[1] = uv / 107.0 - vec2(time / -19.0, time / 31.0);\n  uvs[2] = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\n  uvs[3] = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\n\n  vec4 noise = vec4(0.0);\n  for (int i = 0; i < 4; i++) {\n    noise += texture(normalMap, uvs[i] + vec2(time) / 100.0);\n  }\n  return 0.5 * noise - 1.0;\n}\n\nvec3 sunlight(DirectionalLight sun, vec3 viewDir, vec3 normalDir, vec3 diffuseColor) {\n  // `sun.direction` is in view space\n  vec3 lightDir = normalize(inverse(mat3(viewMatrix)) * sun.direction);\n  vec3 halfDir = normalize(lightDir + viewDir);\n\n  vec3 diffuse = kDiffuse * diffuseColor * max(dot(normalDir, lightDir), 0.0);\n  vec3 specular = vec3(kSpecular * pow(max(dot(normalDir, halfDir), 0.0), shininess));\n\n  return (diffuse + specular) * sun.color;\n}\n\nvoid main() {\n  vec4 noise = getNoise(worldPos.xz * 50.0);\n  vec3 normalDir = normalize(noise.xzy * vec3(2.0, 1.0, 2.0));\n  vec3 viewDir = normalize(cameraPosition - worldPos);\n\n  vec3 color = kAmbient * baseColor;\n  color += sunlight(directionalLights[0], viewDir, normalDir, baseColor);\n  out_FragColor = vec4(color, 1.0);\n\n  #include <fog_fragment>\n}",lights:!0,fog:!0}));var r=Y.water,i=(new d.TextureLoader).load(r.normalMap);return i.wrapS=d.RepeatWrapping,i.wrapT=d.RepeatWrapping,Object.assign(a.uniforms,d.UniformsLib.lights,d.UniformsLib.fog,{normalMap:{value:i},kAmbient:{value:r.uniforms.kAmbient},kDiffuse:{value:r.uniforms.kDiffuse},kSpecular:{value:r.uniforms.kSpecular},shininess:{value:r.uniforms.shininess},baseColor:{value:new d.Color(r.uniforms.baseColor)},time:{value:0}}),a}return n}(d.ShaderMaterial),ie=Object(a.memo)((function(e){var t=e.tileOffsets,n=e.numTiles,o=Object(a.useMemo)((function(){return Object($.a)(new Array(n).keys())}),[n]),c=Object(a.useRef)(o.map((function(){return Object(a.createRef)()}))),s=Y.terrain,l=Object(i.c)(L),u=Object(a.useMemo)((function(){return new re}),[]);return Object(a.useEffect)((function(){t.forEach((function(e,t){var n;(n=c.current[t].current.position).set.apply(n,Object($.a)(e).concat([l.height]))}))}),[t,l.height]),Object(f.d)((function(){var e=(new Date).getTime();u.uniforms.time.value=e%1e7/Math.pow(10,5-l.speed)})),r.a.createElement("group",{rotation:s.rotation},o.map((function(e,t){return r.a.createElement("mesh",{ref:c.current[t],key:String(e),material:u},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[s.size,s.size,1,1]}))})))})),oe=function(){function e(t,n){Object(q.a)(this,e),this.sideLength=t,this.tileSize=n,this.numTiles=Math.pow(t,2)}return Object(J.a)(e,[{key:"getOffsets",value:function(e,t){for(var n=Math.floor(e/this.tileSize)*this.tileSize,a=Math.floor(t/this.tileSize)*this.tileSize,r=[],i=-this.sideLength/2;i<this.sideLength/2;i+=1)for(var o=-this.sideLength/2;o<this.sideLength/2;o+=1)r.push([n+(o+.5)*this.tileSize,a+(i+.5)*this.tileSize]);return r}}],[{key:"offsetsAreEqual",value:function(e,t){for(var n=0;n<9;n+=1)for(var a=0;a<2;a+=1)if(e[n][a]!==t[n][a])return!1;return!0}}]),e}(),ce=Object(a.memo)((function(){var e=Object(f.f)().camera,t=Y.terrain,n=Y.lights,o=n.hemisphere,c=n.directional,s=Y.tileSideLength,l=Object(i.c)(C),u=Object(a.useMemo)((function(){return new oe(s,t.size)}),[s,t.size]),m=Object(a.useState)(u.getOffsets(0,0)),p=Object(g.a)(m,2),v=p[0],d=p[1];return Object(f.d)((function(){var n=e.position,a=n.x+t.size/2,r=-n.z+t.size/2,i=u.getOffsets(a,r);oe.offsetsAreEqual(i,v)||d(i)})),r.a.createElement(r.a.Fragment,null,r.a.createElement("hemisphereLight",{args:[o.skyColor,o.groundColor,o.intensity]}),c.map((function(e){var t=e.direction,n=e.intensity;return r.a.createElement("directionalLight",{position:t,intensity:n,key:"".concat(t,"-").concat(n)})})),r.a.createElement("fogExp2",{attach:"fog",args:[l.color,l.density]}),r.a.createElement(ae,{tileOffsets:v,numTiles:u.numTiles}),r.a.createElement(ie,{tileOffsets:v,numTiles:u.numTiles}))})),se=n(42),le=(n(128),n(9)),ue=n(45),me=n.n(ue),pe={options:{}};A.forEach((function(e){var t=e.name;pe.options[t]=Y.terrain.uniforms[t]}));var fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _.OPTIONS:return me()(e,{options:Object(le.a)({},t.name,{$set:t.value})});case _.RESET_OPTIONS:return Object(Q.a)(Object(Q.a)({},e),{},{options:pe.options});default:return e}},ve={options:{}};R.forEach((function(e){var t=e.name;ve.options[t]=Y.fog[t]}));var ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case z.OPTIONS:return me()(e,{options:Object(le.a)({},t.name,{$set:t.value})});case z.RESET_OPTIONS:return Object(Q.a)(Object(Q.a)({},e),{},{options:ve.options});default:return e}},de={options:{}};F.forEach((function(e){var t=e.name;de.options[t]=Y.water.uniforms[t]}));var he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.OPTIONS:return me()(e,{options:Object(le.a)({},t.name,{$set:t.value})});case D.RESET_OPTIONS:return Object(Q.a)(Object(Q.a)({},e),{},{options:de.options});default:return e}},be=Object(se.d)(se.a.apply(void 0,[]))(se.e)(Object(se.c)({terrain:fe,fog:ge,water:he})),Oe=n(95),ye=Object(Oe.a)({palette:{type:"dark"}}),je=Object(T.a)((function(e){return{app:{display:"flex",height:"100%"},canvas:{background:"lightgrey"},stats:{left:"auto !important",top:"auto !important",right:"0px !important",bottom:"0px !important",marginRight:e.spacing(1),marginBottom:e.spacing(1)}}})),xe=function(){var e=je();return r.a.createElement(m.a,{className:e.app},r.a.createElement(p.a,{theme:ye},r.a.createElement(G,null),r.a.createElement(H,null),r.a.createElement(f.a,{className:e.canvas,gl2:!0},r.a.createElement(v.b,{className:e.stats}),r.a.createElement(i.a,{store:be},r.a.createElement(j,{movementSpeed:Y.camera.movementSpeed}),r.a.createElement(v.a,{position:Y.camera.position,makeDefault:!0}),r.a.createElement(ce,null)))))};n(132);l.a.useDefaults({formatter:function(e,t){e.unshift("".concat(t.level.name))}});var Ee=function(){return u.a.isWebGL2Available()?r.a.createElement(i.a,{store:be},r.a.createElement(xe,null)):r.a.createElement(r.a.Fragment,null,u.a.getWebGL2ErrorMessage().textContent)};c.a.render(r.a.createElement(Ee,null),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.45af9cb8.chunk.js.map